{% extends 'base.html' %}
{% block content %}
{% load static %}

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
<div class="body-wrapper">
    <div class="container-fluid">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                {% if log_id.user_type == 'Staff' %} <li class="breadcrumb-item"><a href="{% url 'staff_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>{% endif %}
                {% if log_id.user_type == 'Company' %} <li class="breadcrumb-item"><a href="{% url 'company_dashboard' %}" class="text-warning-emphasis">Dashboard</a></li>{% endif %}
                 <li class="breadcrumb-item"><a href="{% url 'loan_listing' %}" class="text-warning-emphasis">Loan Account</a></li>
                 <li class="breadcrumb-item" aria-current="page">Edit Loan Account Details</li>
        </nav>
        <div class="row mt-5">
            <div class="col-md-12">
                <div class="card mb-3 bg-black shadow p-3 mb-5 rounded" style="max-width: 1200px;">
                  <div class="row mt-4">
        <section>
            <div class="container pl-5" style="color:white;">
                <div class="header pb-5">
                    <h2 style="text-align: center;color:white;">EDIT LOAN ACCOUNT DETAILS</h2>
                    <hr class="text-warning font-weight-bold">
                    {% for message in messages %}
                    <h5>
                        <div class="alert alert-danger message">
                            {{ message }}
                        </div>
                    </h5>
                    {% endfor %}
                </div>
                <form method="POST" action="{% url 'edit_loan' account.id %}" enctype="multipart/form-data" >
                    {% csrf_token %}
                    <div class="row">
                        <div class="data  col-lg-8 col-md-6 col-sm-16">
                            <div class="row pb-3">
                                <div class="col-6">
                                    <label for="account_name">Account Name</label>
                                </div>
                                <div class="col-6 d-flex">
                                    
                                       <select class="form-control text-dark bg-light" name="account_name" >
                                        <option value="" selected hidden>Select</option>
                                         {% for acc in bank_holder %}
                                           <option value="{{ acc.id }}" selected>{{ acc.customer_name }}</option>
                                        {% endfor %}
                                        
                                    </select>
                                    <!-- <button type="submit" class="btn btn-primary ml-2" data-toggle="modal" data-target="#accountModal">+</button> -->
                                        
                                     
                                </div>
                            </div>
                            <div class="row pb-3">
                                <div class="col-6">
                                    <label for="">Account Number</label>
                                </div>
                                <div class="input-container col-6">
                                    <input type="text" class="form-control text-dark bg-light" name="account_number" value="{{account.bank_holder.account_number}}" >
                                </div>
                            </div>
                            <div class="row pb-3">
                                <div class="col-6">
                                    <label for="">Loan Amount</label>
                                </div>
                                <div class="input-container col-6">
                                    <input type="text" class="form-control text-dark bg-light" name="loan_amount" value="{{account.loan_amount}}" >
                                </div>
                            </div>
                            <div class="row pb-3">
                                <div class="col-6">
                                    <label for="">Lender Bank</label>
                                </div>
                                <div class="input-container col-6">
                                    <input type="text" class="form-control text-dark bg-light" name="lender_bank" value="{{account.lender_bank}}">
                                </div>
                            </div>
                            <div class="row pb-3">
                                <div class="col-6">
                                    <label for="">Date</label>
                                </div>
                                <div class="input-container col-6">
                                    <input type="date" class="form-control text-dark bg-light" name="loan_date" value="{{ account.loan_date | date:'Y-m-d' }}" >
                                </div>
                            </div>
                            <div class="row pb-3">
                                <div class="col-6">
                                    <label for="sdate">Loan Recieved</label>
                                </div>
                                <div class="input-container col-6">
                                    <select class="form-control text-dark bg-light" name="payment_method"  >
                                        <option value="" selected hidden>Select</option>
                                        <option value="Cash" {% if loan.payment_method == 'Cash' %} selected {% endif %}>Cash</option>
                                        <option value="UPI" {% if loan.payment_method == 'UPI' %} selected {% endif %}>UPI</option>
                                        <option value="Cheque" {% if loan.payment_method == 'Cheque' %} selected {% endif %}>Cheque</option>
                                        {% for bank in banks %}
                                        <option value="{{ bank.bnk_name }}- {{ bank.bnk_acno|slice:'-4:' }}">{{ bank.bnk_name }}-( {{ bank.bnk_acno|slice:'-4:' }})</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            
                            
                                <div class="row pb-3">
                                    <div class="col-6">
                                        <label for="">Terms</label>
                                    </div>
                                    <div class="input-container col-6">
                                        <input type="text" class="form-control text-dark bg-light" name="terms"  value="{{account.term}}">
                                    </div>
                                </div>
                           
                            
                                <div class="row pb-3">
                                    <div class="col-6">
                                        <label for="">Processing Paid from</label>
                                    </div>
                                    <div class="input-container col-6">
                                        <select class="form-control text-dark bg-light" name="processing_method"  >
                                            <option value="" selected hidden>Select</option>
                                            <option value="Cash">Cash</option>
                                            <option value="UPI">UPI</option>
                                            <option value="Cheque">Cheque</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-6">
                                        <label for="">Interest rate</label>
                                    </div>
                                    <div class="input-container col-6">
                                        <input type="number" class="form-control text-dark bg-light" name="interest"  value="{{account.interest}}">
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-6">
                                        <label for="">Processing fee</label>
                                    </div>
                                    <div class="input-container col-6">
                                        <input type="number" class="form-control text-dark bg-light" name="processing_fee"  value="{{account.processing_fee}}" >
                                    </div>
                                </div>
                                <div class="row pb-3">
                                    <div class="col-6">
                                        <label for="">Description</label>
                                    </div>
                                    <div class="input-container col-6">
                                        <input type="text" class="form-control text-dark bg-light" name="description" value="{{account.description}}">
                                    </div>
                                </div>
                            </div>
                            <button type="submit"  class="btn btn-outline-warning mt-2" >Save</button>
                        </div>
                    </div>
        
                        </section>
                        

                        
                        <script>
                            $(document).on("click","submitFormBtn",function() {
                                $.ajax({
                                        url: "{% url 'save_account_details' %}",
                                        type: "POST",
                                        data: $("#accountForm").serialize(),
                                        success: function(response) {
                                        document.getElementById("accountForm").reset();
                                        reloadVendor();
                                        },
                                });
                            });
function reloadholder() {

$.ajax({
  url: "",
  type: "GET",
  dataType: "json",
  data: $(this).serialize(),
  csrfmiddlewaretoken: '{{ csrf_token }}',

  success: function(data) { debugger
    var dropdown = $('#holder');
    dropdown.empty();
    dropdown.append($('<option></option>').text('Select Account name'));
    $.each(data, function(key, value) {
      dropdown.append($('<option></option>').attr('value', key).text(value[1] + ' ' + value[2]).val(value[3]+' '+ value[1] + ' ' + value[2]));
    });
  },
  error: function(xhr, status, error) {
  console.error(xhr.responseText);
  }
});
}

</script>

<script>
    $(document).ready(function(){
        
        $('select[name="account_name"]').change(function(){
            var selectedAccountId = $(this).val();

           
            $.ajax({
                url: '{% url "add_loan" %}', 
                type: 'POST',
                data: {account_id: selectedAccountId},
                success: function(data) {
                    
                    $('input[name="account_number"]').val(data.account_number);
                },
                error: function(error) {
                    console.log(error);
                }
            });
        });
    });
</script>

{% endblock %}
